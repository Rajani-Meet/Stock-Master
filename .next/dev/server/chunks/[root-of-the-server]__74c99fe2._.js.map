{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/Stock%20Master/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\n\nexport const db =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: [\"query\", \"error\"],\n  })\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAQ;AACzB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///E:/Stock%20Master/lib/auth.ts"],"sourcesContent":["import { hash, compare } from \"bcryptjs\"\nimport { cookies } from \"next/headers\"\n\nexport async function hashPassword(password: string): Promise<string> {\n  return hash(password, 10)\n}\n\nexport async function comparePassword(password: string, hashedPassword: string): Promise<boolean> {\n  return compare(password, hashedPassword)\n}\n\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return compare(password, hashedPassword)\n}\n\nexport function generateOTP(): string {\n  return Math.floor(100000 + Math.random() * 900000).toString()\n}\n\nexport function generateResetToken(): string {\n  return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15)\n}\n\nexport async function getCurrentUser() {\n  const cookieStore = await cookies()\n  const authToken = cookieStore.get(\"auth_token\")\n  \n  if (!authToken) {\n    return null\n  }\n  \n  try {\n    const decoded = JSON.parse(Buffer.from(authToken.value, \"base64\").toString())\n    return decoded\n  } catch {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;;;AAEO,eAAe,aAAa,QAAgB;IACjD,OAAO,IAAA,2IAAI,EAAC,UAAU;AACxB;AAEO,eAAe,gBAAgB,QAAgB,EAAE,cAAsB;IAC5E,OAAO,IAAA,8IAAO,EAAC,UAAU;AAC3B;AAEO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,IAAA,8IAAO,EAAC,UAAU;AAC3B;AAEO,SAAS;IACd,OAAO,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAQ,QAAQ;AAC7D;AAEO,SAAS;IACd,OAAO,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,MAAM,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG;AAC/F;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,YAAY,YAAY,GAAG,CAAC;IAElC,IAAI,CAAC,WAAW;QACd,OAAO;IACT;IAEA,IAAI;QACF,MAAM,UAAU,KAAK,KAAK,CAAC,OAAO,IAAI,CAAC,UAAU,KAAK,EAAE,UAAU,QAAQ;QAC1E,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 210, "column": 0}, "map": {"version":3,"sources":["file:///E:/Stock%20Master/lib/email.ts"],"sourcesContent":["import nodemailer from 'nodemailer'\n\nconst transporter = nodemailer.createTransport({\n  host: process.env.SMTP_HOST,\n  port: 587,\n  secure: false,\n  auth: {\n    user: process.env.SMTP_USER,\n    pass: process.env.SMTP_PASS\n  }\n})\n\nexport async function sendOTP(email: string, otp: string) {\n  await transporter.sendMail({\n    from: process.env.FROM_EMAIL,\n    to: email,\n    subject: 'StockMaster - Password Reset OTP',\n    html: `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <title>Password Reset OTP</title>\n      </head>\n      <body style=\"margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f5f5f5;\">\n        <div style=\"max-width: 600px; margin: 0 auto; background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n          <!-- Header -->\n          <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px 30px; text-align: center;\">\n            <h1 style=\"color: white; margin: 0; font-size: 28px; font-weight: bold;\">StockMaster</h1>\n            <p style=\"color: rgba(255, 255, 255, 0.9); margin: 8px 0 0 0; font-size: 16px;\">Inventory Management System</p>\n          </div>\n          \n          <!-- Content -->\n          <div style=\"padding: 40px 30px;\">\n            <h2 style=\"color: #333; margin: 0 0 20px 0; font-size: 24px;\">Password Reset Request</h2>\n            <p style=\"color: #666; line-height: 1.6; margin: 0 0 30px 0; font-size: 16px;\">We received a request to reset your password. Use the verification code below to proceed:</p>\n            \n            <!-- OTP Box -->\n            <div style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; padding: 30px; text-align: center; margin: 30px 0;\">\n              <p style=\"color: white; margin: 0 0 10px 0; font-size: 14px; text-transform: uppercase; letter-spacing: 1px;\">Your Verification Code</p>\n              <div style=\"background: white; border-radius: 6px; padding: 20px; display: inline-block; min-width: 200px;\">\n                <span style=\"font-size: 32px; font-weight: bold; color: #333; letter-spacing: 4px; font-family: 'Courier New', monospace;\">${otp}</span>\n              </div>\n            </div>\n            \n            <div style=\"background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; padding: 15px; margin: 20px 0;\">\n              <p style=\"color: #856404; margin: 0; font-size: 14px;\">‚ö†Ô∏è This code expires in <strong>10 minutes</strong> for security reasons.</p>\n            </div>\n            \n            <p style=\"color: #666; line-height: 1.6; margin: 20px 0 0 0; font-size: 14px;\">If you didn't request this password reset, please ignore this email or contact support if you have concerns.</p>\n          </div>\n          \n          <!-- Footer -->\n          <div style=\"background: #f8f9fa; padding: 20px 30px; border-top: 1px solid #e9ecef; text-align: center;\">\n            <p style=\"color: #6c757d; margin: 0; font-size: 12px;\">¬© 2024 StockMaster. All rights reserved.</p>\n            <p style=\"color: #6c757d; margin: 5px 0 0 0; font-size: 12px;\">This is an automated message, please do not reply.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `\n  })\n}\n\nexport async function sendLowStockAlert(email: string, products: any[]) {\n  const productRows = products.map(p => `\n    <tr style=\"border-bottom: 1px solid #e9ecef;\">\n      <td style=\"padding: 12px; color: #333;\">${p.name}</td>\n      <td style=\"padding: 12px; color: #666; font-family: monospace;\">${p.sku}</td>\n      <td style=\"padding: 12px; color: #dc3545; font-weight: bold;\">${p.currentStock}</td>\n      <td style=\"padding: 12px; color: #666;\">${p.minStockLevel}</td>\n    </tr>\n  `).join('')\n\n  await transporter.sendMail({\n    from: process.env.FROM_EMAIL,\n    to: email,\n    subject: `StockMaster - Low Stock Alert (${products.length} items)`,\n    html: `\n      <!DOCTYPE html>\n      <html>\n      <body style=\"margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f5f5f5;\">\n        <div style=\"max-width: 600px; margin: 0 auto; background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n          <div style=\"background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); padding: 30px; text-align: center;\">\n            <h1 style=\"color: white; margin: 0; font-size: 24px;\">‚ö†Ô∏è Low Stock Alert</h1>\n            <p style=\"color: rgba(255, 255, 255, 0.9); margin: 8px 0 0 0;\">StockMaster Inventory System</p>\n          </div>\n          <div style=\"padding: 30px;\">\n            <p style=\"color: #666; margin: 0 0 20px 0;\">The following products are running low on stock and need immediate attention:</p>\n            <table style=\"width: 100%; border-collapse: collapse; margin: 20px 0;\">\n              <thead>\n                <tr style=\"background: #f8f9fa;\">\n                  <th style=\"padding: 12px; text-align: left; color: #333;\">Product</th>\n                  <th style=\"padding: 12px; text-align: left; color: #333;\">SKU</th>\n                  <th style=\"padding: 12px; text-align: left; color: #333;\">Current</th>\n                  <th style=\"padding: 12px; text-align: left; color: #333;\">Min Level</th>\n                </tr>\n              </thead>\n              <tbody>${productRows}</tbody>\n            </table>\n            <div style=\"background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 6px; padding: 15px; margin: 20px 0;\">\n              <p style=\"color: #856404; margin: 0; font-size: 14px;\">üìã Please review and reorder these items to maintain optimal inventory levels.</p>\n            </div>\n          </div>\n          <div style=\"background: #f8f9fa; padding: 20px; text-align: center;\">\n            <p style=\"color: #6c757d; margin: 0; font-size: 12px;\">¬© 2024 StockMaster. All rights reserved.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `\n  })\n}\n\nexport async function sendReportEmail(email: string, reportType: string, reportData: any) {\n  await transporter.sendMail({\n    from: process.env.FROM_EMAIL,\n    to: email,\n    subject: `StockMaster - ${reportType} Report Generated`,\n    html: `\n      <!DOCTYPE html>\n      <html>\n      <body style=\"margin: 0; padding: 0; font-family: Arial, sans-serif; background-color: #f5f5f5;\">\n        <div style=\"max-width: 600px; margin: 0 auto; background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\">\n          <div style=\"background: linear-gradient(135deg, #28a745 0%, #20c997 100%); padding: 30px; text-align: center;\">\n            <h1 style=\"color: white; margin: 0; font-size: 24px;\">üìä Report Generated</h1>\n            <p style=\"color: rgba(255, 255, 255, 0.9); margin: 8px 0 0 0;\">StockMaster Analytics</p>\n          </div>\n          <div style=\"padding: 30px;\">\n            <h2 style=\"color: #333; margin: 0 0 20px 0;\">${reportType} Report Summary</h2>\n            <div style=\"background: #f8f9fa; border-radius: 6px; padding: 20px; margin: 20px 0;\">\n              ${reportType === 'Inventory' ? `\n                <p style=\"margin: 5px 0; color: #666;\"><strong>Total Products:</strong> ${reportData.summary?.totalProducts || 0}</p>\n                <p style=\"margin: 5px 0; color: #666;\"><strong>Total Value:</strong> $${reportData.summary?.totalValue || 0}</p>\n                <p style=\"margin: 5px 0; color: #666;\"><strong>Low Stock Items:</strong> ${reportData.summary?.lowStockCount || 0}</p>\n                <p style=\"margin: 5px 0; color: #666;\"><strong>Out of Stock:</strong> ${reportData.summary?.outOfStockCount || 0}</p>\n              ` : `\n                <p style=\"margin: 5px 0; color: #666;\"><strong>Total Movements:</strong> ${reportData.summary?.totalMovements || 0}</p>\n                <p style=\"margin: 5px 0; color: #666;\"><strong>Inbound:</strong> ${reportData.summary?.inbound || 0}</p>\n                <p style=\"margin: 5px 0; color: #666;\"><strong>Outbound:</strong> ${reportData.summary?.outbound || 0}</p>\n                <p style=\"margin: 5px 0; color: #666;\"><strong>Adjustments:</strong> ${reportData.summary?.adjustments || 0}</p>\n              `}\n            </div>\n            <p style=\"color: #666; margin: 20px 0 0 0; font-size: 14px;\">Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>\n          </div>\n          <div style=\"background: #f8f9fa; padding: 20px; text-align: center;\">\n            <p style=\"color: #6c757d; margin: 0; font-size: 12px;\">¬© 2024 StockMaster. All rights reserved.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `\n  })\n}\n\nexport async function checkAndSendLowStockAlerts() {\n  try {\n    const lowStockProducts = await db.stockLevel.findMany({\n      where: {\n        quantity: {\n          lte: db.product.fields.minStockLevel\n        }\n      },\n      include: {\n        product: true,\n        location: {\n          include: {\n            warehouse: true\n          }\n        }\n      }\n    })\n\n    if (lowStockProducts.length > 0) {\n      const adminUsers = await db.user.findMany({\n        where: {\n          role: { in: ['ADMIN', 'MANAGER'] },\n          isActive: true\n        }\n      })\n\n      const products = lowStockProducts.map(sl => ({\n        name: sl.product.name,\n        sku: sl.product.sku,\n        currentStock: sl.quantity,\n        minStockLevel: sl.product.minStockLevel\n      }))\n\n      for (const user of adminUsers) {\n        await sendLowStockAlert(user.email, products)\n      }\n    }\n  } catch (error) {\n    console.error('Failed to send low stock alerts:', error)\n  }\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 418, "column": 0}, "map": {"version":3,"sources":["file:///E:/Stock%20Master/app/api/reports/inventory/route.ts"],"sourcesContent":["import { db } from \"@/lib/db\"\nimport { getCurrentUser } from \"@/lib/auth\"\nimport { sendReportEmail } from \"@/lib/email\"\nimport { NextResponse } from \"next/server\"\n\nexport async function GET(req: Request) {\n  try {\n    const { searchParams } = new URL(req.url)\n    const warehouseId = searchParams.get(\"warehouseId\")\n    const categoryId = searchParams.get(\"categoryId\")\n    const sendEmail = searchParams.get(\"sendEmail\") === 'true'\n\n    const where: any = {}\n    if (warehouseId) where.warehouseId = warehouseId\n    if (categoryId) where.product = { categoryId }\n\n    const stockLevels = await db.stockLevel.findMany({\n      where,\n      include: {\n        product: { include: { category: true } },\n        warehouse: true,\n        location: true\n      }\n    })\n\n    const totalValue = stockLevels.reduce((sum, sl) => sum + (sl.quantity * 10), 0) // Assuming avg price 10\n    const lowStockCount = stockLevels.filter(sl => sl.quantity <= sl.product.minStockLevel).length\n    const outOfStockCount = stockLevels.filter(sl => sl.quantity === 0).length\n\n    const reportData = {\n      summary: {\n        totalProducts: stockLevels.length,\n        totalValue,\n        lowStockCount,\n        outOfStockCount\n      },\n      details: stockLevels\n    }\n\n    if (sendEmail) {\n      const currentUser = await getCurrentUser()\n      if (currentUser) {\n        const user = await db.user.findUnique({ where: { id: currentUser.userId } })\n        if (user) {\n          await sendReportEmail(user.email, 'Inventory', reportData)\n        }\n      }\n    }\n\n    return NextResponse.json({ ...reportData, success: true })\n  } catch (error) {\n    return NextResponse.json({ error: \"Failed to generate inventory report\" }, { status: 500 })\n  }\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,IAAI,GAAY;IACpC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,cAAc,aAAa,GAAG,CAAC;QACrC,MAAM,aAAa,aAAa,GAAG,CAAC;QACpC,MAAM,YAAY,aAAa,GAAG,CAAC,iBAAiB;QAEpD,MAAM,QAAa,CAAC;QACpB,IAAI,aAAa,MAAM,WAAW,GAAG;QACrC,IAAI,YAAY,MAAM,OAAO,GAAG;YAAE;QAAW;QAE7C,MAAM,cAAc,MAAM,iHAAE,CAAC,UAAU,CAAC,QAAQ,CAAC;YAC/C;YACA,SAAS;gBACP,SAAS;oBAAE,SAAS;wBAAE,UAAU;oBAAK;gBAAE;gBACvC,WAAW;gBACX,UAAU;YACZ;QACF;QAEA,MAAM,aAAa,YAAY,MAAM,CAAC,CAAC,KAAK,KAAO,MAAO,GAAG,QAAQ,GAAG,IAAK,GAAG,wBAAwB;;QACxG,MAAM,gBAAgB,YAAY,MAAM,CAAC,CAAA,KAAM,GAAG,QAAQ,IAAI,GAAG,OAAO,CAAC,aAAa,EAAE,MAAM;QAC9F,MAAM,kBAAkB,YAAY,MAAM,CAAC,CAAA,KAAM,GAAG,QAAQ,KAAK,GAAG,MAAM;QAE1E,MAAM,aAAa;YACjB,SAAS;gBACP,eAAe,YAAY,MAAM;gBACjC;gBACA;gBACA;YACF;YACA,SAAS;QACX;QAEA,IAAI,WAAW;YACb,MAAM,cAAc,MAAM,IAAA,+HAAc;YACxC,IAAI,aAAa;gBACf,MAAM,OAAO,MAAM,iHAAE,CAAC,IAAI,CAAC,UAAU,CAAC;oBAAE,OAAO;wBAAE,IAAI,YAAY,MAAM;oBAAC;gBAAE;gBAC1E,IAAI,MAAM;oBACR,MAAM,IAAA,iIAAe,EAAC,KAAK,KAAK,EAAE,aAAa;gBACjD;YACF;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,GAAG,UAAU;YAAE,SAAS;QAAK;IAC1D,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsC,GAAG;YAAE,QAAQ;QAAI;IAC3F;AACF"}}]
}