{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/Stock%20Master/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\n\nexport const db =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: [\"query\", \"error\"],\n  })\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAQ;AACzB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///E:/Stock%20Master/app/api/products/route.ts"],"sourcesContent":["import { db } from \"@/lib/db\"\nimport { type NextRequest, NextResponse } from \"next/server\"\n\nexport async function GET(req: NextRequest) {\n  try {\n    const { searchParams } = new URL(req.url)\n    const category = searchParams.get(\"category\")\n    const search = searchParams.get(\"search\")\n    const unit = searchParams.get(\"unit\")\n    const lowStock = searchParams.get(\"lowStock\")\n    const skip = Number.parseInt(searchParams.get(\"skip\") || \"0\")\n    const take = Number.parseInt(searchParams.get(\"take\") || \"20\")\n    const sortBy = searchParams.get(\"sortBy\") || \"name\"\n    const sortOrder = searchParams.get(\"sortOrder\") || \"asc\"\n\n    const where: any = { isActive: true }\n    if (category) where.categoryId = category\n    if (unit) where.unit = unit\n    if (search) {\n      where.OR = [\n        { name: { contains: search, mode: \"insensitive\" } },\n        { sku: { contains: search, mode: \"insensitive\" } },\n        { description: { contains: search, mode: \"insensitive\" } }\n      ]\n    }\n\n    const [products, total] = await Promise.all([\n      db.product.findMany({\n        where,\n        include: { \n          category: true,\n          stockLevels: {\n            select: {\n              quantity: true,\n              warehouse: { select: { name: true } }\n            }\n          }\n        },\n        skip,\n        take,\n        orderBy: { [sortBy]: sortOrder },\n      }),\n      db.product.count({ where }),\n    ])\n\n    let filteredProducts = products\n    if (lowStock === \"true\") {\n      filteredProducts = products.filter(p => {\n        const totalStock = p.stockLevels.reduce((sum, sl) => sum + sl.quantity, 0)\n        return totalStock <= p.minStockLevel\n      })\n    }\n\n    return NextResponse.json({\n      data: filteredProducts,\n      total,\n      pages: Math.ceil(total / take),\n    })\n  } catch (error) {\n    console.error(\"Get products error:\", error)\n    return NextResponse.json({ error: \"Failed to fetch products\" }, { status: 500 })\n  }\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json()\n    const { name, sku, categoryId, unit, description, minStockLevel, maxStockLevel, reorderQty } = body\n\n    if (!name || !sku || !categoryId) {\n      return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 })\n    }\n\n    const product = await db.product.create({\n      data: {\n        name,\n        sku,\n        categoryId,\n        unit,\n        description,\n        minStockLevel: minStockLevel || 10,\n        maxStockLevel,\n        reorderQty: reorderQty || 50,\n      },\n      include: { category: true },\n    })\n\n    return NextResponse.json(product, { status: 201 })\n  } catch (error: any) {\n    console.error(\"Create product error:\", error)\n    if (error.code === \"P2002\") {\n      return NextResponse.json({ error: \"SKU already exists\" }, { status: 409 })\n    }\n    return NextResponse.json({ error: \"Failed to create product\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}