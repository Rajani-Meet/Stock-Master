{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/Stock%20Master/lib/db.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\n\nexport const db =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: [\"query\", \"error\"],\n  })\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AAEC,MAAM,KACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;KAAQ;AACzB;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///E:/Stock%20Master/lib/auth.ts"],"sourcesContent":["import { hash, compare } from \"bcryptjs\"\nimport { cookies } from \"next/headers\"\n\nexport async function hashPassword(password: string): Promise<string> {\n  return hash(password, 10)\n}\n\nexport async function comparePassword(password: string, hashedPassword: string): Promise<boolean> {\n  return compare(password, hashedPassword)\n}\n\nexport async function verifyPassword(password: string, hashedPassword: string): Promise<boolean> {\n  return compare(password, hashedPassword)\n}\n\nexport function generateOTP(): string {\n  return Math.floor(100000 + Math.random() * 900000).toString()\n}\n\nexport function generateResetToken(): string {\n  return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15)\n}\n\nexport async function getCurrentUser() {\n  const cookieStore = await cookies()\n  const authToken = cookieStore.get(\"auth_token\")\n  \n  if (!authToken) {\n    return null\n  }\n  \n  try {\n    const decoded = JSON.parse(Buffer.from(authToken.value, \"base64\").toString())\n    return decoded\n  } catch {\n    return null\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;AACA;;;AAEO,eAAe,aAAa,QAAgB;IACjD,OAAO,IAAA,2IAAI,EAAC,UAAU;AACxB;AAEO,eAAe,gBAAgB,QAAgB,EAAE,cAAsB;IAC5E,OAAO,IAAA,8IAAO,EAAC,UAAU;AAC3B;AAEO,eAAe,eAAe,QAAgB,EAAE,cAAsB;IAC3E,OAAO,IAAA,8IAAO,EAAC,UAAU;AAC3B;AAEO,SAAS;IACd,OAAO,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAQ,QAAQ;AAC7D;AAEO,SAAS;IACd,OAAO,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,MAAM,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG;AAC/F;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,YAAY,YAAY,GAAG,CAAC;IAElC,IAAI,CAAC,WAAW;QACd,OAAO;IACT;IAEA,IAAI;QACF,MAAM,UAAU,KAAK,KAAK,CAAC,OAAO,IAAI,CAAC,UAAU,KAAK,EAAE,UAAU,QAAQ;QAC1E,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 126, "column": 0}, "map": {"version":3,"sources":["file:///E:/Stock%20Master/app/api/auth/login/route.ts"],"sourcesContent":["import { db } from \"@/lib/db\"\nimport { comparePassword } from \"@/lib/auth\"\nimport { type NextRequest, NextResponse } from \"next/server\"\nimport { z } from \"zod\"\n\nconst LoginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(1),\n})\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json()\n    const { email, password } = LoginSchema.parse(body)\n\n    const user = await db.user.findUnique({\n      where: { email },\n    })\n\n    if (!user) {\n      return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 })\n    }\n\n    if (!user.isActive) {\n      return NextResponse.json({ error: \"User account is inactive\" }, { status: 403 })\n    }\n\n    const isPasswordValid = await comparePassword(password, user.password)\n\n    if (!isPasswordValid) {\n      return NextResponse.json({ error: \"Invalid credentials\" }, { status: 401 })\n    }\n\n    await db.user.update({\n      where: { id: user.id },\n      data: { lastLoginAt: new Date() },\n    })\n\n    // Create session token (simple base64 encoded user data)\n    const sessionToken = Buffer.from(JSON.stringify({ userId: user.id, email: user.email, role: user.role })).toString(\"base64\")\n\n    const response = NextResponse.json({\n      message: \"Login successful\",\n      user: {\n        id: user.id,\n        email: user.email,\n        name: user.name,\n        role: user.role,\n      },\n    })\n\n    // Set secure HTTP-only cookie\n    response.cookies.set(\"auth_token\", sessionToken, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      maxAge: 60 * 60 * 24 * 7, // 7 days\n    })\n\n    // Log audit\n    await db.auditLog.create({\n      data: {\n        userId: user.id,\n        action: \"LOGIN\",\n        entityType: \"User\",\n        entityId: user.id,\n      },\n    })\n\n    return response\n  } catch (error) {\n    console.error(\"Login error:\", error)\n    if (error instanceof z.ZodError) {\n      return NextResponse.json({ error: error.errors }, { status: 400 })\n    }\n\n    // In development, return the error message/stack to help debugging.\n    if (process.env.NODE_ENV !== \"production\") {\n      return NextResponse.json(\n        { error: \"Internal server error\", details: (error as any)?.message, stack: (error as any)?.stack },\n        { status: 500 }\n      )\n    }\n\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,cAAc,yKAAC,CAAC,MAAM,CAAC;IAC3B,OAAO,yKAAC,CAAC,MAAM,GAAG,KAAK;IACvB,UAAU,yKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC3B;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,YAAY,KAAK,CAAC;QAE9C,MAAM,OAAO,MAAM,iHAAE,CAAC,IAAI,CAAC,UAAU,CAAC;YACpC,OAAO;gBAAE;YAAM;QACjB;QAEA,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,IAAI,CAAC,KAAK,QAAQ,EAAE;YAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,kBAAkB,MAAM,IAAA,gIAAe,EAAC,UAAU,KAAK,QAAQ;QAErE,IAAI,CAAC,iBAAiB;YACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,MAAM,iHAAE,CAAC,IAAI,CAAC,MAAM,CAAC;YACnB,OAAO;gBAAE,IAAI,KAAK,EAAE;YAAC;YACrB,MAAM;gBAAE,aAAa,IAAI;YAAO;QAClC;QAEA,yDAAyD;QACzD,MAAM,eAAe,OAAO,IAAI,CAAC,KAAK,SAAS,CAAC;YAAE,QAAQ,KAAK,EAAE;YAAE,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;QAAC,IAAI,QAAQ,CAAC;QAEnH,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;YACjC,SAAS;YACT,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;gBACf,MAAM,KAAK,IAAI;YACjB;QACF;QAEA,8BAA8B;QAC9B,SAAS,OAAO,CAAC,GAAG,CAAC,cAAc,cAAc;YAC/C,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,KAAK,KAAK,KAAK;QACzB;QAEA,YAAY;QACZ,MAAM,iHAAE,CAAC,QAAQ,CAAC,MAAM,CAAC;YACvB,MAAM;gBACJ,QAAQ,KAAK,EAAE;gBACf,QAAQ;gBACR,YAAY;gBACZ,UAAU,KAAK,EAAE;YACnB;QACF;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,IAAI,iBAAiB,yKAAC,CAAC,QAAQ,EAAE;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,MAAM,MAAM;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAClE;QAEA,oEAAoE;QACpE,wCAA2C;YACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAAyB,SAAU,OAAe;gBAAS,OAAQ,OAAe;YAAM,GACjG;gBAAE,QAAQ;YAAI;QAElB;;;IAGF;AACF"}}]
}